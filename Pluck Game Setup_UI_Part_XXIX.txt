using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using System.Drawing;
using System.Media;
using System.Threading.Tasks;
using System.Net.Sockets;
using System.Net;
using System.Text;
using System.Threading;

public class PluckGameForm : Form
{
    private Label dealerLabel;
    private Label trumpLabel;
    private Button playRoundButton;
    private Button startTournamentButton;
    private Button rankedMatchButton;
    private Button achievementsButton;
    private Button spectatorModeButton;
    private Button dailyChallengeButton;
    private Button battlePassButton;
    private ListBox[] playerHands;
    private PictureBox[] playerAvatars;
    private Button playCardButton;
    private Button pluckCardButton;
    private Button tutorialButton;
    private Button settingsButton;
    private Button replayButton;
    private TextBox gameLog;
    private Label trickLabel;
    private Label pluckInstructionLabel;
    private ComboBox pluckSelectionBox;
    private Label statsLabel;
    private Label leaderboardLabel;
    private Label battlePassLabel;
    private int playerXP;
    private int battlePassLevel;
    private Dictionary<int, string> battlePassRewards;
    private SoundPlayer cardPlaySound;
    private SoundPlayer pluckSound;
    private Dictionary<string, int> playerWins;
    private Dictionary<string, string> playerAchievements;
    private Dictionary<string, string> aiPersonalities;
    private bool isTournamentMode;
    private bool isSpectatorMode;
    private string selectedTheme = "Classic";

    private Game game;
    private string currentPlayer;
    private string plucker;
    private string pluckee;

    public PluckGameForm(bool multiplayerMode)
    {
        this.Text = "Pluck Card Game - Battle Pass System";
        this.Size = new Size(1000, 1100);
        SetTheme(selectedTheme);

        dealerLabel = new Label() { Text = "Dealer: ", Location = new Point(20, 20), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        trumpLabel = new Label() { Text = "Trump: ", Location = new Point(20, 50), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        
        playRoundButton = new Button() { Text = "Play Round", Location = new Point(20, 80), Font = new Font("Arial", 10), BackColor = Color.Gold };
        playRoundButton.Click += PlayRound_Click;

        startTournamentButton = new Button() { Text = "Start Tournament", Location = new Point(300, 80), Font = new Font("Arial", 10), BackColor = Color.Red };
        startTournamentButton.Click += StartTournament;
        
        rankedMatchButton = new Button() { Text = "Find Ranked Match", Location = new Point(600, 80), Font = new Font("Arial", 10), BackColor = Color.Cyan };
        rankedMatchButton.Click += StartRankedMatch;
        
        achievementsButton = new Button() { Text = "Achievements", Location = new Point(720, 80), Font = new Font("Arial", 10), BackColor = Color.LightBlue };
        achievementsButton.Click += ShowAchievements;
        
        spectatorModeButton = new Button() { Text = "Spectator Mode", Location = new Point(20, 120), Font = new Font("Arial", 10), BackColor = Color.Purple };
        spectatorModeButton.Click += EnableSpectatorMode;
        
        dailyChallengeButton = new Button() { Text = "Daily Challenge", Location = new Point(300, 120), Font = new Font("Arial", 10), BackColor = Color.Yellow };
        dailyChallengeButton.Click += ShowDailyChallenge;

        battlePassButton = new Button() { Text = "Battle Pass", Location = new Point(600, 120), Font = new Font("Arial", 10), BackColor = Color.Orange };
        battlePassButton.Click += ShowBattlePassProgress;

        battlePassLabel = new Label() { Text = "Battle Pass Level: 1 | XP: 0", Location = new Point(20, 880), Size = new Size(960, 30), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };

        settingsButton = new Button() { Text = "Settings", Location = new Point(720, 120), Font = new Font("Arial", 10), BackColor = Color.Orange };
        settingsButton.Click += OpenSettings;

        replayButton = new Button() { Text = "Replay Match", Location = new Point(720, 160), Font = new Font("Arial", 10), BackColor = Color.LightGreen, Enabled = false };
        replayButton.Click += StartReplay;

        gameLog = new TextBox() { Location = new Point(20, 500), Size = new Size(960, 200), Multiline = true, ReadOnly = true, Font = new Font("Arial", 10), BackColor = Color.Black, ForeColor = Color.LimeGreen };
        trickLabel = new Label() { Text = "Trick in Progress: ", Location = new Point(20, 710), Size = new Size(960, 30), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };

        this.Controls.Add(dealerLabel);
        this.Controls.Add(trumpLabel);
        this.Controls.Add(playRoundButton);
        this.Controls.Add(startTournamentButton);
        this.Controls.Add(rankedMatchButton);
        this.Controls.Add(achievementsButton);
        this.Controls.Add(spectatorModeButton);
        this.Controls.Add(dailyChallengeButton);
        this.Controls.Add(battlePassButton);
        this.Controls.Add(battlePassLabel);
        this.Controls.Add(settingsButton);
        this.Controls.Add(replayButton);
        this.Controls.Add(gameLog);
        this.Controls.Add(trickLabel);

        playerXP = 0;
        battlePassLevel = 1;
        battlePassRewards = new Dictionary<int, string>()
        {
            { 1, "Welcome Badge" },
            { 5, "Gold Card Sleeve" },
            { 10, "Custom Avatar" },
            { 20, "Exclusive Game Mode" }
        };
    }

    private void ShowBattlePassProgress(object sender, EventArgs e)
    {
        string rewardText = battlePassRewards.ContainsKey(battlePassLevel) ? battlePassRewards[battlePassLevel] : "Keep progressing for more rewards!";
        MessageBox.Show($"Battle Pass Level: {battlePassLevel}\nXP: {playerXP}\nNext Reward: {rewardText}", "Battle Pass", MessageBoxButtons.OK, MessageBoxIcon.Information);
    }

    private void EarnXP(int amount)
    {
        playerXP += amount;
        if (playerXP >= battlePassLevel * 100)
        {
            battlePassLevel++;
            gameLog.Text += $"\nCongratulations! You reached Battle Pass Level {battlePassLevel}!";
        }
        battlePassLabel.Text = $"Battle Pass Level: {battlePassLevel} | XP: {playerXP}";
    }
}
