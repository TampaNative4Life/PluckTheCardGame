using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using System.Drawing;
using System.Media;
using System.Threading.Tasks;
using System.Net.Sockets;
using System.Net;
using System.Text;
using System.Threading;

public class PluckGameForm : Form
{
    private Label dealerLabel;
    private Label trumpLabel;
    private Button playRoundButton;
    private Button startTournamentButton;
    private ListBox[] playerHands;
    private PictureBox[] playerAvatars;
    private Button playCardButton;
    private Button pluckCardButton;
    private Button tutorialButton;
    private Button settingsButton;
    private Button replayButton;
    private TextBox gameLog;
    private Label trickLabel;
    private Label pluckInstructionLabel;
    private ComboBox pluckSelectionBox;
    private Label statsLabel;
    private Label leaderboardLabel;
    private SoundPlayer cardPlaySound;
    private SoundPlayer pluckSound;
    private Dictionary<string, int> playerWins;
    private Dictionary<string, string> playerAvatarsPaths;
    private bool isTournamentMode;
    private string selectedTheme = "Classic";

    private Game game;
    private string currentPlayer;
    private string plucker;
    private string pluckee;

    public PluckGameForm(bool multiplayerMode)
    {
        this.Text = "Pluck Card Game - Customizable UI";
        this.Size = new Size(1000, 1000);
        SetTheme(selectedTheme);

        dealerLabel = new Label() { Text = "Dealer: ", Location = new Point(20, 20), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        trumpLabel = new Label() { Text = "Trump: ", Location = new Point(20, 50), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        
        playRoundButton = new Button() { Text = "Play Round", Location = new Point(20, 80), Font = new Font("Arial", 10), BackColor = Color.Gold };
        playRoundButton.Click += PlayRound_Click;

        startTournamentButton = new Button() { Text = "Start Tournament", Location = new Point(300, 80), Font = new Font("Arial", 10), BackColor = Color.Red };
        startTournamentButton.Click += StartTournament;

        settingsButton = new Button() { Text = "Settings", Location = new Point(720, 120), Font = new Font("Arial", 10), BackColor = Color.Orange };
        settingsButton.Click += OpenSettings;

        replayButton = new Button() { Text = "Replay Match", Location = new Point(720, 160), Font = new Font("Arial", 10), BackColor = Color.LightGreen, Enabled = false };
        replayButton.Click += StartReplay;

        gameLog = new TextBox() { Location = new Point(20, 500), Size = new Size(960, 200), Multiline = true, ReadOnly = true, Font = new Font("Arial", 10), BackColor = Color.Black, ForeColor = Color.LimeGreen };
        trickLabel = new Label() { Text = "Trick in Progress: ", Location = new Point(20, 710), Size = new Size(960, 30), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };

        this.Controls.Add(dealerLabel);
        this.Controls.Add(trumpLabel);
        this.Controls.Add(playRoundButton);
        this.Controls.Add(startTournamentButton);
        this.Controls.Add(settingsButton);
        this.Controls.Add(replayButton);
        this.Controls.Add(gameLog);
        this.Controls.Add(trickLabel);

        playerAvatars = new PictureBox[3];
        playerAvatarsPaths = new Dictionary<string, string>
        {
            { "Player 1", "avatar1.png" },
            { "Player 2", "avatar2.png" },
            { "Player 3", "avatar3.png" }
        };
        
        for (int i = 0; i < playerAvatars.Length; i++)
        {
            playerAvatars[i] = new PictureBox()
            {
                Location = new Point(20 + (i * 320), 350),
                Size = new Size(100, 100),
                BackColor = Color.White,
                Image = Image.FromFile(playerAvatarsPaths[$"Player {i + 1}"])
            };
            this.Controls.Add(playerAvatars[i]);
        }
    }

    private void SetTheme(string theme)
    {
        if (theme == "Classic")
        {
            this.BackColor = Color.DarkGreen;
        }
        else if (theme == "Modern")
        {
            this.BackColor = Color.DarkBlue;
        }
    }

    private void OpenSettings(object sender, EventArgs e)
    {
        SettingsForm settingsForm = new SettingsForm(this);
        settingsForm.ShowDialog();
    }

    public void ApplyTheme(string theme)
    {
        selectedTheme = theme;
        SetTheme(theme);
    }
}

public class SettingsForm : Form
{
    private ComboBox themeBox;
    private Button saveButton;
    private PluckGameForm mainForm;

    public SettingsForm(PluckGameForm form)
    {
        mainForm = form;
        this.Text = "Settings";
        this.Size = new Size(400, 300);

        themeBox = new ComboBox() { Location = new Point(20, 40), Size = new Size(200, 30) };
        themeBox.Items.AddRange(new string[] { "Classic", "Modern" });
        themeBox.SelectedItem = "Classic";

        saveButton = new Button() { Text = "Save", Location = new Point(20, 80), Size = new Size(100, 30) };
        saveButton.Click += SaveSettings;

        this.Controls.Add(themeBox);
        this.Controls.Add(saveButton);
    }

    private void SaveSettings(object sender, EventArgs e)
    {
        mainForm.ApplyTheme(themeBox.SelectedItem.ToString());
        this.Close();
    }
}