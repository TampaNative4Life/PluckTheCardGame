using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;
using System.Drawing;
using System.Media;
using System.Threading.Tasks;
using System.Net.Sockets;
using System.Net;
using System.Text;

public class PluckGameForm : Form
{
    private Label dealerLabel;
    private Label trumpLabel;
    private Button playRoundButton;
    private ListBox player1Hand;
    private ListBox player2Hand;
    private ListBox player3Hand;
    private Button playCardButton;
    private Button pluckCardButton;
    private Button tutorialButton;
    private Button hostGameButton;
    private Button joinGameButton;
    private Button settingsButton;
    private TextBox gameLog;
    private Label trickLabel;
    private Label pluckInstructionLabel;
    private ComboBox pluckSelectionBox;
    private Label statsLabel;
    private Label leaderboardLabel;
    private SoundPlayer cardPlaySound;
    private SoundPlayer pluckSound;
    private Dictionary<string, int> playerWins;
    private Dictionary<string, int> aiMemory;
    private TcpClient client;
    private TcpListener server;
    private NetworkStream stream;
    private bool isHost;
    private const int Port = 5000;
    private GameSettings gameSettings;

    private Game game;
    private string currentPlayer;
    private string plucker;
    private string pluckee;

    public PluckGameForm(bool multiplayerMode)
    {
        this.Text = "Pluck Card Game";
        this.Size = new Size(900, 800);
        this.BackColor = Color.DarkGreen;

        dealerLabel = new Label() { Text = "Dealer: ", Location = new Point(20, 20), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        trumpLabel = new Label() { Text = "Trump: ", Location = new Point(20, 50), AutoSize = true, Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        
        playRoundButton = new Button() { Text = "Play Round", Location = new Point(20, 80), Font = new Font("Arial", 10), BackColor = Color.Gold };
        playRoundButton.Click += PlayRound_Click;

        playCardButton = new Button() { Text = "Play Card", Location = new Point(300, 80), Font = new Font("Arial", 10), BackColor = Color.Gold };
        playCardButton.Click += PlayCard_Click;

        pluckCardButton = new Button() { Text = "Pluck Card", Location = new Point(500, 80), Font = new Font("Arial", 10), Enabled = false, BackColor = Color.Gold };
        pluckCardButton.Click += PluckCard_Click;

        tutorialButton = new Button() { Text = "Tutorial", Location = new Point(720, 80), Font = new Font("Arial", 10), BackColor = Color.LightBlue };
        tutorialButton.Click += ShowTutorial;

        settingsButton = new Button() { Text = "Settings", Location = new Point(720, 120), Font = new Font("Arial", 10), BackColor = Color.Orange };
        settingsButton.Click += OpenSettings;

        player1Hand = new ListBox() { Location = new Point(20, 120), Size = new Size(200, 150), Font = new Font("Arial", 10), BackColor = Color.White };
        player2Hand = new ListBox() { Location = new Point(300, 120), Size = new Size(200, 150), Font = new Font("Arial", 10), BackColor = Color.White };
        player3Hand = new ListBox() { Location = new Point(580, 120), Size = new Size(200, 150), Font = new Font("Arial", 10), BackColor = Color.White };
        
        gameLog = new TextBox() { Location = new Point(20, 300), Size = new Size(860, 150), Multiline = true, ReadOnly = true, Font = new Font("Arial", 10), BackColor = Color.Black, ForeColor = Color.LimeGreen };
        trickLabel = new Label() { Text = "Trick in Progress: ", Location = new Point(20, 460), Size = new Size(860, 30), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        pluckInstructionLabel = new Label() { Text = "", Location = new Point(20, 500), Size = new Size(860, 30), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        
        pluckSelectionBox = new ComboBox() { Location = new Point(20, 530), Size = new Size(200, 30), Enabled = false, BackColor = Color.White };

        statsLabel = new Label() { Text = "Statistics:\nPlayer 1: 0 Wins | Player 2: 0 Wins | Player 3: 0 Wins", Location = new Point(20, 580), Size = new Size(860, 50), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };
        leaderboardLabel = new Label() { Text = "Leaderboard:\n1. -\n2. -\n3. -", Location = new Point(20, 640), Size = new Size(860, 80), Font = new Font("Arial", 12, FontStyle.Bold), ForeColor = Color.White };

        this.Controls.Add(dealerLabel);
        this.Controls.Add(trumpLabel);
        this.Controls.Add(playRoundButton);
        this.Controls.Add(playCardButton);
        this.Controls.Add(pluckCardButton);
        this.Controls.Add(tutorialButton);
        this.Controls.Add(settingsButton);
        this.Controls.Add(player1Hand);
        this.Controls.Add(player2Hand);
        this.Controls.Add(player3Hand);
        this.Controls.Add(gameLog);
        this.Controls.Add(trickLabel);
        this.Controls.Add(pluckInstructionLabel);
        this.Controls.Add(pluckSelectionBox);
        this.Controls.Add(statsLabel);
        this.Controls.Add(leaderboardLabel);

        gameSettings = new GameSettings();
    }

    private void OpenSettings(object sender, EventArgs e)
    {
        SettingsForm settingsForm = new SettingsForm(gameSettings);
        settingsForm.ShowDialog();
    }
}

public class GameSettings
{
    public string Theme { get; set; } = "Classic";
    public string Difficulty { get; set; } = "Normal";
    public bool EnableSound { get; set; } = true;
}

public class SettingsForm : Form
{
    private ComboBox themeBox;
    private ComboBox difficultyBox;
    private CheckBox soundCheck;
    private GameSettings settings;

    public SettingsForm(GameSettings gameSettings)
    {
        settings = gameSettings;
        this.Text = "Settings";
        this.Size = new Size(400, 300);

        themeBox = new ComboBox() { Location = new Point(20, 40), Size = new Size(200, 30) };
        themeBox.Items.AddRange(new string[] { "Classic", "Modern" });
        themeBox.SelectedItem = settings.Theme;

        difficultyBox = new ComboBox() { Location = new Point(20, 80), Size = new Size(200, 30) };
        difficultyBox.Items.AddRange(new string[] { "Easy", "Normal", "Hard" });
        difficultyBox.SelectedItem = settings.Difficulty;

        soundCheck = new CheckBox() { Text = "Enable Sound", Location = new Point(20, 120), Checked = settings.EnableSound };

        this.Controls.Add(themeBox);
        this.Controls.Add(difficultyBox);
        this.Controls.Add(soundCheck);
    }
}
